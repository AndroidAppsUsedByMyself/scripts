#!/system/bin/sh

# SPDX-FileCopyrightText: 2017-2021 The LineageOS Project
# SPDX-License-Identifier: Apache-2.0

# Release keys
media_cert_release='308203b33082029ba003020102020900e1c286d5b6096213300d06092a864886f70d01010505003070310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c6531123010060355040a0c094c696e656167654f5331123010060355040b0c094c696e656167654f533112301006035504030c094c696e656167654f53301e170d3137303130373034323132385a170d3434303532353034323132385a3070310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c6531123010060355040a0c094c696e656167654f5331123010060355040b0c094c696e656167654f533112301006035504030c094c696e656167654f5330820122300d06092a864886f70d01010105000382010f003082010a0282010100cc818ef9a14c1ae3b79fb0805f59aff780e9a8b28bddf9c71703af8ffc15dc30a8439a6ebbfea3b2ca429cd07b1feb6a3b33446688964cf70f23e9637d91ef0a5654c2d4261487fdb9bb0b01abfd52f5edc2aec205a7849b0f66ac25d9e434a43e8a5cc75f11df6847c5f7d9fdad45ef0f6bf53f8c7bb73319e6a28bfee7e06e97d5d2b7d53c8cf2d2638ede5404dfd27cc39c7631c9a52eb632f79cb108b50d0e136bd639d19b4f05e5c840680a0241b86fd702c2c44b2f196e306eac2dc40066f1ea1e43496b1ba4c85fedfd68374064f139a5630dde0c84a0e9dbb7f953562fe400ff02bcc6aadfda63fd572e473da83e22bf21c1421fefb3c3707d5a97630203010001a350304e301d0603551d0e04160414fbc481032a0bed6d36b8d11d46e0ef18ebfc06b2301f0603551d23041830168014fbc481032a0bed6d36b8d11d46e0ef18ebfc06b2300c0603551d13040530030101ff300d06092a864886f70d010105050003820101007dd63789ed7427ca371673242b6c5f7fb669bcb6f681ad833e413bcba56be119df42ae035681d806a7c6fb8db17a09120b7dcde5b28752466e6afaf57339f6d9d6ef74f687535021e7c33c0c8c99bd10bcd587c2856b8ba1318ea9616aee74b6d60efd15a59014c190b9c8bb79ad942db520ff0c2fd7ebef7f68424ab9a375f7768a24a8c0f954de6c31c3880d87ec8e518daf51466a78c3182e8fcfe5774e217309b27e6110f84f0bbe89d15d21d77c4c269e14e9d88619145fdf43aa17b54388006cb8bf648001951bc5a1f2b308f6f5b1c929fa522406a84b253c3032187fa5480aaf3de4eba86b2bc43371b5eb2bf26f1ce17ab4413a5793087e41c10f05'
media_key_release='MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAzIGO+aFMGuO3n7CAX1mv94DpqLKL3fnHFwOvj/wV3DCoQ5puu/6jsspCnNB7H+tqOzNEZoiWTPcPI+ljfZHvClZUwtQmFIf9ubsLAav9UvXtwq7CBaeEmw9mrCXZ5DSkPopcx18R32hHxffZ/a1F7w9r9T+Me7czGeaii/7n4G6X1dK31TyM8tJjjt5UBN/SfMOcdjHJpS62MvecsQi1DQ4Ta9Y50ZtPBeXIQGgKAkG4b9cCwsRLLxluMG6sLcQAZvHqHkNJaxukyF/t/Wg3QGTxOaVjDd4MhKDp27f5U1Yv5AD/ArzGqt/aY/1XLkc9qD4ivyHBQh/vs8NwfVqXYwIDAQAB'
platform_cert_release='308203b33082029ba003020102020900d94a816d624a0050300d06092a864886f70d01010505003070310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c6531123010060355040a0c094c696e656167654f5331123010060355040b0c094c696e656167654f533112301006035504030c094c696e656167654f53301e170d3137303130373034323132365a170d3434303532353034323132365a3070310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c6531123010060355040a0c094c696e656167654f5331123010060355040b0c094c696e656167654f533112301006035504030c094c696e656167654f5330820122300d06092a864886f70d01010105000382010f003082010a02820101009a41d7715c8ce053804b1260bbad6c332def57bfd3d26b26102d8892ce9a3d0b780b3bf4cfc5778303470110cde8f6be1766147128731ec202977b62f1b4ae9b0e331a334a27c84c31b5885c4bd4650423cae821c7e08522515f63a9d3667f8c8b33cc9c322704e4645e37b13a50a8d04d3b04dcd0e1a87efbc32e7172f296df8ea33fcb071f9868d91a462e894fe49670ae27354dbfd14a83a23e6c775ae40761c91e416b042ceff81cf66d9e4d73c4bce7e14d6347dcbeab38820316be81decda9a7d5de8da71f1fe0e64a570da004279a6ea2628de4a839a7fdd9baa2d1c5445c6a6e7ed1949a18cd5a23cf602d7dd3d8cf17c953aa525454f17eaef84ea50203010001a350304e301d0603551d0e04160414609957d0ee9881d4d84690e80386c723b738d223301f0603551d23041830168014609957d0ee9881d4d84690e80386c723b738d223300c0603551d13040530030101ff300d06092a864886f70d0101050500038201010063e903bdcb6ee9c7767a170080caccea08a96d7f732fecdd261acdab1f651c701593051408ef0aec2de88fd7e8e7502815cc04a8b47ce35fba0179d0a3f0e7c7e0fc94cce049c34f3601e525b1b92ab19a2618749da33921b090321cff9f146eab1abd9166021a022f003e1034d0c7ba2e3937cfcd75700575fc9d542643924b4d869716eec2c226b1947bc11fe3cd45e3ba27bd52724e30fb69174d6d87199baa425642ab5b2da659ed9da32809311cbc217d1a72f60e8257a191083f210a909507fa08ce8a467b0434fee41a9c068ad0ada084ca87290f0c70b7f16e0d22a31a5dda2a0de059e63257126191a55523d714096582028e99b089b213e71467b2'
platform_key_release='MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAmkHXcVyM4FOASxJgu61sMy3vV7/T0msmEC2Iks6aPQt4Czv0z8V3gwNHARDN6Pa+F2YUcShzHsICl3ti8bSumw4zGjNKJ8hMMbWIXEvUZQQjyughx+CFIlFfY6nTZn+MizPMnDInBORkXjexOlCo0E07BNzQ4ah++8MucXLylt+Ooz/LBx+YaNkaRi6JT+SWcK4nNU2/0UqDoj5sd1rkB2HJHkFrBCzv+Bz2bZ5Nc8S85+FNY0fcvqs4ggMWvoHezamn1d6Npx8f4OZKVw2gBCeabqJijeSoOaf92bqi0cVEXGpuftGUmhjNWiPPYC1909jPF8lTqlJUVPF+rvhOpQIDAQAB'
shared_cert_release='308203b33082029ba003020102020900dacb4739a1727e6e300d06092a864886f70d01010505003070310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c6531123010060355040a0c094c696e656167654f5331123010060355040b0c094c696e656167654f533112301006035504030c094c696e656167654f53301e170d3137303130373034323132375a170d3434303532353034323132375a3070310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c6531123010060355040a0c094c696e656167654f5331123010060355040b0c094c696e656167654f533112301006035504030c094c696e656167654f5330820122300d06092a864886f70d01010105000382010f003082010a028201010096f2f8f3dad19ee79f28256693ce970bda272f72025b4c4a6c20e027a921622530e1b780f9117c98f10b910259005a27da5020d9345844acec3da13ee0d684e067958a23dfc751ec497f5e3f3b13023c5428edc53aadbc44c10bfa84abd436bf13f8222ebf724f7e2e557e81effe21faa52b88899108cd62b7d5a84821576ed2edf50b83324a93439185b078711974395763265f7465b6bb908b0139489707cd4e76e4937545751f6b9c90d7b4bd17a234613d0919ca66e34d78906d5eaa43409e7c57d74266996f2e3f1d5a6061b65fb19f85c62829a8b3978541e64b3fa4f9febcbf5b291eaa433774c45749f73e12d377b9f9b0dfd0d7d8003a78c144a2f50203010001a350304e301d0603551d0e04160414b4dc1c6737cee40f786a398c8bb345d8a8eecbc2301f0603551d23041830168014b4dc1c6737cee40f786a398c8bb345d8a8eecbc2300c0603551d13040530030101ff300d06092a864886f70d010105050003820101002002b4557df909ace023d050f6c739b57ef311ce39abffda1b74161a71554ab78fd23b2b4b57d8c31e646f71f9063e1486a0502da00cfe4d87c4a75dd1eec6416b4460adace72a1cde79ea39f95e4fa3eb1777b9c2f080438298b963d21b54aa3aa7fc6f1b9717333c7b5244ac7862f07c34f443a72462141742f309f51e349fe21b21affcb5369c8723eef2ad2f1452b6bce685337a2751d3bd33eabece08bd62ed6801e6e331eaba7ae0a6dfb632a4fe184141013869bbdbd0d564a44091349890e178f755d14d08d6d868e4abdaa27759fcd576b1f2026db630d11639fd9672d54f0c15b03dc754c5c11ff168d3dd6b2dc7b58e7f47f472f684c41c87bd9e'
shared_key_release='MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAlvL489rRnuefKCVmk86XC9onL3ICW0xKbCDgJ6khYiUw4beA+RF8mPELkQJZAFon2lAg2TRYRKzsPaE+4NaE4GeViiPfx1HsSX9ePzsTAjxUKO3FOq28RMEL+oSr1Da/E/giLr9yT34uVX6B7/4h+qUriImRCM1it9WoSCFXbtLt9QuDMkqTQ5GFsHhxGXQ5V2MmX3RltruQiwE5SJcHzU525JN1RXUfa5yQ17S9F6I0YT0JGcpm4014kG1eqkNAnnxX10JmmW8uPx1aYGG2X7GfhcYoKaizl4VB5ks/pPn+vL9bKR6qQzd0xFdJ9z4S03e5+bDf0NfYADp4wUSi9QIDAQAB'
release_cert='308203b33082029ba003020102020900e10413c773c3c54f300d06092a864886f70d01010505003070310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c6531123010060355040a0c094c696e656167654f5331123010060355040b0c094c696e656167654f533112301006035504030c094c696e656167654f53301e170d3137303130373034323132355a170d3434303532353034323132355a3070310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c6531123010060355040a0c094c696e656167654f5331123010060355040b0c094c696e656167654f533112301006035504030c094c696e656167654f5330820122300d06092a864886f70d01010105000382010f003082010a0282010100a64dd3e1f842038ff03f67b8e9bf09530fc2913cb53e3654c78ec20dbc8b1e7113628ca5abc0860560cb442c1b51f98b6dce5e59c49037f27f64f48aef0490ab99106f0807a2130e1a8b3aacd834e656f0854b602677b66c007b14c2d0c28d0dc61341de648d879db59a9e79e12888731a3bb1c61fb58f725ac071de12b61093decc5685ac2474cee2cf22f0e44bf208410d91c5d1f60aa7945548822bad756a70e0fe17c83f35e5fa59be4dd2b446048f9b42332186ff0aa47ed39c210de9fd981c55719ec8f30caac4415c21605f13f57d0ecdf0682c484e9456748debe80e2f2e0b1cf47fb95d92fff4673e16f63781f3b2c7cd4b904041abeb5df85059990203010001a350304e301d0603551d0e0416041472963227d66c4c4d5fa0916ac22c793cd45f435c301f0603551d2304183016801472963227d66c4c4d5fa0916ac22c793cd45f435c300c0603551d13040530030101ff300d06092a864886f70d010105050003820101008a247e01c9c72e7167dec24993f23f539c07618c2819ee4d3eae96d283173aebe112469405c4c48052ef1ec72f2949ac0677b49eac5055bea2fe75a8dd3dfc8b3ccf88fb10c4a0c2779dc2861e80b445128c18485ce2b4b4f74ff0389247659b5386572374d0f9bf26ccc261e783397ca3808d5a19de26f8db84d92ac6872b0bdbc60ac768e4ac74d142e7f2c5d5c1cabbca5d1baadb923252b19ba0950370d556707c37c399c936a67e08fd1748cea5656d8add7fa2177ed630796d8de0fae9570b274a04590984d5c065fe307a5346eb54962e41f580d1a448463112e2d5f491a39bb9f9a2a0cac5855c28a35fbdb1ad4a6aeab2aea2f9056e73fc487737eb'
release_key='MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEApk3T4fhCA4/wP2e46b8JUw/CkTy1PjZUx47CDbyLHnETYoylq8CGBWDLRCwbUfmLbc5eWcSQN/J/ZPSK7wSQq5kQbwgHohMOGos6rNg05lbwhUtgJne2bAB7FMLQwo0NxhNB3mSNh521mp554SiIcxo7scYftY9yWsBx3hK2EJPezFaFrCR0zuLPIvDkS/IIQQ2RxdH2CqeUVUiCK611anDg/hfIPzXl+lm+TdK0RgSPm0IzIYb/CqR+05whDen9mBxVcZ7I8wyqxEFcIWBfE/V9Ds3waCxITpRWdI3r6A4vLgsc9H+5XZL/9Gc+FvY3gfOyx81LkEBBq+td+FBZmQIDAQAB'

# Test keys
media_cert_test='3082032130820209a0030201020214727a6c223d17d4adcc8b5fb290f5fe49930088da300d06092a864886f70d01010b0500301f311d301b06035504030c14526f626f746e6978207073746172206d656469613020170d3235303430343137333935355a180f32303532303832303137333935355a301f311d301b06035504030c14526f626f746e6978207073746172206d6564696130820122300d06092a864886f70d01010105000382010f003082010a0282010100c3d2dc5d509b4ca699a57ba92aa8b4d7eea9f5de6e2dba2da22928ae404f3cf8f89f823d0db0fc1c72cc86964661552de6f2f1c21a7515226e5a7e6f202e95852f2c3ee13252e6763eb9014ec12c188550db0086c5d09e87869a49e76503893f0f54b1b65270526e0ea5e4d6c4926bfeed7b693e92817b374eeb5f1197dac2ba9873257a85159fe8f69ad868adbd58eba31101b562157aee10f58b777b7a39b42d907820326b8f230f9d81ac7cd23b563fe3ae8ad92894ed8383c5214a19245a3c0117bc79a66a889281eb196346d86ab28daa539d9fca672f496c3b4fdb02b31996f37b0d935acdf80a51dea7a655e1f66123013f02b7f9c255e766df7343d70203010001a3533051301d0603551d0e04160414acc6443b75cbfe30ea836ac9549eef0d47a423bd301f0603551d23041830168014acc6443b75cbfe30ea836ac9549eef0d47a423bd300f0603551d130101ff040530030101ff300d06092a864886f70d01010b050003820101008228aa0b986bc7f7e2ae98b3ce569707cf605680e83646643fe4758bb178cd9a0ef678837bc172a573d13edc79a0b1ea7efa4ceebad06058ea6f99f20acb13364dfdeaba6d3bc3e506a418fa19305101ec184e8728f47d87349b00fedf45b55cfaed6a72f9aadf499d58289843b90af4c11b22ec4a502d20788cac4fdfce2d9c11c594c14b8f42efe7354bc7d6173084ad36e189b61e6d13a718ca4e8f7cf1a5ae74734af15c13130326437047cb5278cafeedc81ff3111261171b81018874dde04276d274aa7f587a5ec026ddf09b2354a33959ed341ab05daee764279ebe70ae1d4e195d764429be718c4ee2ab380beeda6b355c984447507be449cd0b60cf'
media_key_test='MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAw9LcXVCbTKaZpXupKqi01+6p9d5uLbotoikorkBPPPj4n4I9DbD8HHLMhpZGYVUt5vLxwhp1FSJuWn5vIC6VhS8sPuEyUuZ2PrkBTsEsGIVQ2wCGxdCeh4aaSedlA4k/D1SxtlJwUm4OpeTWxJJr/u17aT6SgXs3TutfEZfawrqYcyV6hRWf6Paa2GitvVjroxEBtWIVeu4Q9Yt3e3o5tC2QeCAya48jD52BrHzSO1Y/466K2SiU7YODxSFKGSRaPAEXvHmmaoiSgesZY0bYarKNqlOdn8pnL0lsO0/bArMZlvN7DZNazfgKUd6nplXh9mEjAT8Ct/nCVedm33ND1wIDAQAB'
platform_cert_test='308203273082020fa003020102021426f03089c0443f6b1d62108aed31b5a82af9b826300d06092a864886f70d01010b050030223120301e06035504030c17526f626f746e697820707374617220706c6174666f726d3020170d3235303430343137333935345a180f32303532303832303137333935345a30223120301e06035504030c17526f626f746e697820707374617220706c6174666f726d30820122300d06092a864886f70d01010105000382010f003082010a0282010100fa5e6df6e93a432bbd9ca3488138933d63521936e2744ed7f537a731a5f9cf15a5f54bb7d42d093b44ef7b99ad411d26b88e011d54315d52a7e8beeac2e6907cb7a190c0ac5d066efb68cfa8d1dd4361304926b64dd0577ac39ffd450b591bbfefd67f38acdf4f903c1ab948d98cd5d3b4116f4e14d167fa8c07c637deffc7b24af64fd780b0a8471f67adfc9e3126a28f9c6f0fe2b85f88ed98eabb7dcb470ac1c5a7ebdf1a74869bbff47b5623e88d728dd4ad68080837aa52a3d8fc54e978e699385733192778e3f4e673faa5ddf3e3fbfafb236644198e34c03b98eccb39131fd9b8d6872990fbc9d49a00d735a4211db7a4d9bd60c3102cc619c146bc450203010001a3533051301d0603551d0e041604142fdd7fe33670aab6668843d14088549934fc7c20301f0603551d230418301680142fdd7fe33670aab6668843d14088549934fc7c20300f0603551d130101ff040530030101ff300d06092a864886f70d01010b05000382010100d009209ec4ca0a7045db4b68f8bcb8174800e75ce9eb1fa63a3acc94bbd69663298bf23916bf4c8b8ddd98b55e78aaf7562d1c9c923f8e76042cd93ce020ad2aad32bc0896482f3d1618b658f1d091f7daeecf50d52f88b95193974d1620029c33998fb2605fcc3fbb2bf75310e2a85d77a586462a7fc6403b9fbfef5914b1713fa18929f22b2d6d39c01373e34c65f099c999ca407ec94cf1b3363c7aef57e45f2660789cf7dd8cc21df6796c69bf3645910d7ac577c58000eb82be14c519a9ab01216788842cbd0eca42bbc19cfe0a1cfa78ec2576356b89ddd79f156efd492b9e0ee53793e3b4873958170005b5adcdcd9fbf7804d632e773a6cfa6b640ae'
platform_key_test='MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA+l5t9uk6Qyu9nKNIgTiTPWNSGTbidE7X9TenMaX5zxWl9Uu31C0JO0Tve5mtQR0muI4BHVQxXVKn6L7qwuaQfLehkMCsXQZu+2jPqNHdQ2EwSSa2TdBXesOf/UULWRu/79Z/OKzfT5A8GrlI2YzV07QRb04U0Wf6jAfGN97/x7JK9k/XgLCoRx9nrfyeMSaij5xvD+K4X4jtmOq7fctHCsHFp+vfGnSGm7/0e1Yj6I1yjdStaAgIN6pSo9j8VOl45pk4VzMZJ3jj9OZz+qXd8+P7+vsjZkQZjjTAO5jsyzkTH9m41ocpkPvJ1JoA1zWkIR23pNm9YMMQLMYZwUa8RQIDAQAB'
shared_cert_test='308203233082020ba00302010202142a9aafb9883233279822bd766061e182bf11d704300d06092a864886f70d01010b05003020311e301c06035504030c15526f626f746e6978207073746172207368617265643020170d3235303430343137333935345a180f32303532303832303137333935345a3020311e301c06035504030c15526f626f746e69782070737461722073686172656430820122300d06092a864886f70d01010105000382010f003082010a02820101008b9c975a82296d5adf3e4baabed6b6f93b83333676aa38c160ce90297015039977e275c291e037047c34e47b3c77e87547ee73f0fc788eb643dd9c100e8b1b979f6607723c054144c5d09f14ad16b8e3ec6f99f44b6dc754a388624c1e454ac2dbe62e75926b136507e09fe0d1a1dd9748c7fcb6540d18e8695ed5aa16e5e1284e14b37dba09a4114aafd34e29de08e2f4e50925e5408e232b41a83a4a57ffadd004398f1df9ab66b8a717464452bf2a7c667696fc18fa6bf899be40c3a4c85154489b418020c13f4604cf65b29c590078f4b443f35f36216cafc8e4fb1170d039678b2d9fdba02351b8ae7f1e86b7948c21e9b24f0826160715305aa22aa39b0203010001a3533051301d0603551d0e04160414d3fbf0ecb324335cdb1a40d2a63ac405b0061253301f0603551d23041830168014d3fbf0ecb324335cdb1a40d2a63ac405b0061253300f0603551d130101ff040530030101ff300d06092a864886f70d01010b05000382010100349aa71c6a2c98003fa05d83c3c1a447df2d1350593f2aa75d350acf8b66784c3784ea93272e8d0ff45c14538acd17e95b4e6d1056fd89f312a2fe4bcd84abc134b0f08ee5d4a270ab91b0fcb00f2c0cc0f752e9c923b9615130e55fdc8e767424902b482f0faaa8f66732436ddfbc1c94a30f7f9effa19f56e370a1a4104e2ba1ae807e746b53bed0d61e4b7dbbcf9b3cab0f601719b1636f5c1336390304eab7b3242c82a4da687cb7213ceec33fe49e4f2ee56ac86f721b98c3fccdbd2b85b9b1cf5c536ff527c701141a6df6232865e7c58f51aae361c430539bc8ee6c826569d0664cc2c751e86b2d6f222590c56c5400178b639dc4c16ed713314f59c8'
shared_key_test='MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAi5yXWoIpbVrfPkuqvta2+TuDMzZ2qjjBYM6QKXAVA5l34nXCkeA3BHw05Hs8d+h1R+5z8Px4jrZD3ZwQDosbl59mB3I8BUFExdCfFK0WuOPsb5n0S23HVKOIYkweRUrC2+YudZJrE2UH4J/g0aHdl0jH/LZUDRjoaV7Vqhbl4ShOFLN9ugmkEUqv004p3gji9OUJJeVAjiMrQag6Slf/rdAEOY8d+atmuKcXRkRSvyp8ZnaW/Bj6a/iZvkDDpMhRVEibQYAgwT9GBM9lspxZAHj0tEPzXzYhbK/I5PsRcNA5Z4stn9ugI1G4rn8ehreUjCHpsk8IJhYHFTBaoiqjmwIDAQAB'
test_cert='3082032b30820213a003020102021407f4a8fbd934bb46da58f8933fc7b0b7bbf3c249300d06092a864886f70d01010b050030243122302006035504030c19526f626f746e69782070737461722072656c656173656b65793020170d3235303430343137333935345a180f32303532303832303137333935345a30243122302006035504030c19526f626f746e69782070737461722072656c656173656b657930820122300d06092a864886f70d01010105000382010f003082010a0282010100b7386f6a08103067a29ef097a9d511241e044d336e8be8bc9548beee4ea95cf949c3df95e47036aaaa591b476fcf2f726c6e4dad85e0b55334aed0510f45a991ef4712d4013bf2b902e1b8a5f69c475eb7c742b2e79a2c72dc40775b0403c46a1a64a877deb20881941a59388bba9f344c47dc97c63bbd9f757b547b008b657624d2f09ee34c4c6e810ce1498c46fde2b458cf7e7a3d4856ee4c46cead4eb6f16a813dbab869123480247e60967236dd750ffb66a2d84dae7cc2319f15af87ed7209150cc2e28690536c3fe6cbe44ee6b6eaeb6265cdb7973bc6c8d26c21c0f7a03d6667125e95533ce882c29f2d7590222715f6c9a6b84415f733020da4d69b0203010001a3533051301d0603551d0e041604140ebe21364418d69a1d7f27b93ae78d2e138e385a301f0603551d230418301680140ebe21364418d69a1d7f27b93ae78d2e138e385a300f0603551d130101ff040530030101ff300d06092a864886f70d01010b050003820101006a4dbcca17257bbcff325f9a324b96704798a96df79adb7a345238ca41cb540fd6844ff6c184660308ae1ebc5c59d7bf7ed1f293a0a4e154941efd91b77b2e6b2ecff6517eb40dd364c1025f1d14c8b95bdcd20027c87065245303fd4acf7568cd94acd2040492d110eeddfa6d70ce821e821895a781bbca8c0380065cf06d99416a622d48b059370263a4d78d16aafe8a5914b0ed2a0e5a312a73cd32dd266075cd17a133b2c6550df144adf440163090ea7cb5d906ea1abe58ef51f197feefb4efca7afc76e1ae8dbf9c312574e99f77e17898cfc58934a667a33db9b3a4de98d747792edd5e6c6a3d9062ae14a0051a69d1a36f448243b44271c60aca437d'
test_key='MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtzhvaggQMGeinvCXqdURJB4ETTNui+i8lUi+7k6pXPlJw9+V5HA2qqpZG0dvzy9ybG5NrYXgtVM0rtBRD0Wpke9HEtQBO/K5AuG4pfacR163x0Ky55osctxAd1sEA8RqGmSod96yCIGUGlk4i7qfNExH3JfGO72fdXtUewCLZXYk0vCe40xMboEM4UmMRv3itFjPfno9SFbuTEbOrU628WqBPbq4aRI0gCR+YJZyNt11D/tmothNrnzCMZ8Vr4ftcgkVDMLihpBTbD/my+RO5rbq62JlzbeXO8bI0mwhwPegPWZnEl6VUzzogsKfLXWQIicV9smmuEQV9zMCDaTWmwIDAQAB'


PACKAGES=/data/system/packages.xml
PACKAGES_INTERMEDIATE=/data/local/tmp/packages.xml.decoded
PACKAGES_BACKUP=/data/system/packages-backup.xml
MODIFICATION_TARGET=$PACKAGES

ANDROID_VERSION=$(getprop ro.build.version.release)

[ $ANDROID_VERSION -ge 12 ] && USE_ABX=1

case "$1" in
    "official")
        to_official=true
        echo "Unofficial to official migration"
        ;;
    "unofficial")
        echo "Official to unofficial migration"
        ;;
    *)
        echo "USAGE: $0 official|unofficial"
        exit 1
        ;;
esac

if [ $USE_ABX ]; then
    abx2xml $PACKAGES $PACKAGES_INTERMEDIATE
    MODIFICATION_TARGET=$PACKAGES_INTERMEDIATE
fi

# If there's a "backup" copy, then the current packages.xml might
# be corrupted, so overwrite it with the backup copy. This is what
# PackageManager would do.
if [ -f $PACKAGES_BACKUP ]; then
    mv $PACKAGES_BACKUP $PACKAGES
    echo "Overwriting $PACKAGES with $PACKAGES_BACKUP"
fi

if [ ! -f $PACKAGES ]; then
    echo "Error: $PACKAGES not found"
    exit 1
fi

# Save a copy of the current file, not to be confused with
# packages-backup.xml, which is used and generated by Android
echo "Saving backup as $PACKAGES.bak"
cp $PACKAGES $PACKAGES.bak

if [ "$to_official" = "true" ]; then
    sed -i "s#$media_cert_test#$media_cert_release#g" $MODIFICATION_TARGET
    sed -i "s#$platform_cert_test#$platform_cert_release#g" $MODIFICATION_TARGET
    sed -i "s#$shared_cert_test#$shared_cert_release#g" $MODIFICATION_TARGET
    sed -i "s#$test_cert#$release_cert#g" $MODIFICATION_TARGET
    sed -i "s#$media_key_test#$media_key_release#g" $MODIFICATION_TARGET
    sed -i "s#$platform_key_test#$platform_key_release#g" $MODIFICATION_TARGET
    sed -i "s#$shared_key_test#$shared_key_release#g" $MODIFICATION_TARGET
    sed -i "s#$test_key#$release_key#g" $MODIFICATION_TARGET
else
    sed -i "s#$media_cert_release#$media_cert_test#g" $MODIFICATION_TARGET
    sed -i "s#$platform_cert_release#$platform_cert_test#g" $MODIFICATION_TARGET
    sed -i "s#$shared_cert_release#$shared_cert_test#g" $MODIFICATION_TARGET
    sed -i "s#$release_cert#$test_cert#g" $MODIFICATION_TARGET
    sed -i "s#$media_key_release#$media_key_test#g" $MODIFICATION_TARGET
    sed -i "s#$platform_key_release#$platform_key_test#g" $MODIFICATION_TARGET
    sed -i "s#$shared_key_release#$shared_key_test#g" $MODIFICATION_TARGET
    sed -i "s#$release_key#$test_key#g" $MODIFICATION_TARGET
fi

if [ $USE_ABX ]; then
    xml2abx $MODIFICATION_TARGET $PACKAGES
fi

chmod 660 $PACKAGES
chown system:system $PACKAGES

echo "Done"
